<!DOCTYPE html>
<html lang="en">
<head>
<html lang="en">
<script src="server-url.js"></script>
  <script>
    const page = 'dashboard';
  </script>
  <script src="verification.js"></script>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MES CMS - Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>

    
    /* Notification Styles */
    .notification-area {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1100;
      max-width: 350px;
      width: 100%;
    }

    .notification {
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 15px;
      color: white;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
      animation: slideIn 0.3s ease;
      position: relative;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    .notification::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      width: 100%;
      background: rgba(255,255,255,0.5);
      animation: progress 3s linear;
    }

    .notification.success {
      background: #4CAF50;
    }

    .notification.error {
      background: #F44336;
    }

    .notification.warning {
      background: #FF9800;
    }

    .notification.info {
      background: #2196F3;
    }

    @keyframes progress {
      from { width: 100%; }
      to { width: 0%; }
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    /* Dashboard Specific Styles */
    .dashboard-header {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .dashboard-header i {
      font-size: 28px;
      color: var(--primary);
      margin-right: 15px;
    }

    .dashboard-header h1 {
      font-size: 28px;
      color: var(--dark);
      font-weight: 700;
    }

    .stats-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-button {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: default;
    }

    .stat-button:hover {
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      background-color: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }

    .stat-icon img {
      color: white;
      width: 70px;
      height: 70px;
    }

    .stat-title {
      font-size: 16px;
      color: var(--gray);
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }

    .dashboard-panel {
      display: grid;
      grid-template-columns: 2fr 1fr 1.5fr;
      gap: 25px;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
    }

    .panel-section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 30px;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .panel-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--dark);
    }

    .chart-container {
      width: 100%;
      height: 280px;
      position: relative;
    }

    .legend {
      display: flex;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 12px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .legend-item:hover {
      background-color: #f5f5f5;
    }

    .legend-item.active {
      background-color: #e9ecef;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;       /* Change from 3px to 50% */
    }

    .dropdown-menu {
      position: relative;
    }

    .dropdown-toggle {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: var(--gray);
    }

    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      background: white;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border-radius: 8px;
      z-index: 10;
      min-width: 150px;
    }

    .dropdown-content a {
      display: block;
      padding: 10px 15px;
      text-decoration: none;
      color: var(--dark);
      font-size: 14px;
    }

    .dropdown-content a:hover {
      background: #f5f5f5;
    }

    .dropdown-menu:hover .dropdown-content {
      display: block;
    }

    .stats-list {
      display: flex;
      flex-direction: column;
      gap: 60px;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stat-item-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-item-icon i {
      color: var(--primary);
      font-size: 14px;
    }

    .stat-item-content {
      flex: 1;
    }

    .stat-item-title {
      font-size: 14px;
      color: var(--dark);
      margin-bottom: 2px;
    }
    .stat-item-icon img {
      width: 30px;   /* adjust as needed */
      height: 30px;  /* adjust as needed */
      object-fit: contain;
    }

    .stat-item-value {
      font-size: 16px;
      font-weight: 600;
      color: black;
    }

    .info-tooltip {
      position: relative;
      display: inline-block;
      margin-left: 5px;
    }

    .info-tooltip i {
      color: var(--gray);
      font-size: 14px;
      cursor: pointer;
    }

    .tooltip-content {
      display: none;
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--dark);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      width: 200px;
      z-index: 100;
      text-align: left;
    }

    .info-tooltip:hover .tooltip-content {
      display: block;
    }

    .chart-navigation {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .nav-btn {
      padding: 8px 16px;
      border-radius: 20px;
      background: #f5f5f5;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-weight: 600;
    }

    .nav-btn:hover {
      background: #e5e5e5;
    }

    .nav-btn.active {
      background: var(--primary);
      color: white;
    }

    .trends-panel {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 25px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
    }

    .filters-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-group label {
      font-size: 14px;
      font-weight: 600;
      color: var(--dark);
    }

    .filter-select {
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.1);
      background: rgba(248, 249, 250, 0.5);
      font-size: 14px;
    }

    /* Chart Styles */
    .bar-chart {
      display: flex;
      align-items: flex-end;
      height: 200px;
      gap: 8px;
      padding: 0 10px;
      justify-content: space-around;
      margin-top: 20px;
    }

    .bar-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100%;
      width: 30px;
      position: relative;
    }

    .bar-group {
      display: flex;
      align-items: flex-end;
      height: 100%;
      width: 100%;
      gap: 2px;
    }

    .bar {
      width: 100%;
      border-radius: 3px 3px 0 0;
      position: relative;
      transition: opacity 0.3s;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
      
    }

    .bar:hover {
      opacity: 0.8;
      transform: translateY(-2px); /* little lift on hover */
    }

    .bar-label {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      white-space: nowrap;
    }

    .pie-chart-container {
      position: relative;
      width: 100%;
      height: 100%;
      margin: 0 auto;
    }
    
    .pie-chart {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
      padding: 0;
    }

    .pie-segment {
      position: absolute;
      width: 100%;
      height: 100%;
      clip-path: polygon(50% 50%, 50% 0%, 100% 0%, 100% 100%, 50% 100%);
      transform-origin: center;
      border: 2px solid white;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .pie-segment:hover {
      opacity: 0.9;
      transform: scale(1.02);
      z-index: 2;
    }

    .pie-segment.highlighted {
      transform: scale(1.05);
      z-index: 3;
      filter: brightness(1.2);
    }

    .chart-tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 100;
    }

    .trend-filter-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid #ddd;
      background: white;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s;
    }
    
    .filter-btn.active {
      color: white;
    }
    .pending{
      background:   #e74c3c;
      border-color: #e74c3c;
      color: white;
     
    }
    .in-progress{
      background:   #f39c12;
      border-color: #f39c12;
      color: white;
      
    }
    .completed{
      background:   #2ecc71;
      border-color: #2ecc71;
      color: white;
    }
    
    /* Axis labels */
    .chart-with-axes {
      display: flex;
      flex-direction: column;
      height: 250px;
      padding-left: 30px;
      padding-bottom: 30px;
      position: relative;
    }

    .y-axis {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 30px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: flex-end;
      padding: 10px 5px 30px 0;
      font-size: 10px;
      color: var(--gray);
    }

    .x-axis {
      display: flex;
      justify-content: space-around;
      padding-top: 5px;
      font-size: 10px;
      color: var(--gray);
      height: 30px;
    }

    .chart-area {
      flex: 1;
      position: relative;
    }

    /* Find button */
    .find-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: background 0.3s;
      margin-top: 10px;
    }

    .find-btn:hover {
      background: var(--secondary);
    }

    /* Pie chart wrapper */
    .pie-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* Category buttons */
    .category-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 15px;
      justify-content: center;
      max-height: 0px;        /* Keep this */
      overflow-y: auto;         /* Keep this */
      padding: 5px;
      /* Add these properties */
      height: 120px;            /* Fixed height */
      align-content: flex-start; /* Align items at the top */
    }

    .category-btn {
      padding: 6px 10px;
      border-radius: 15px;
      border: none;
      font-size: 11px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .category-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.16);
    }

    .category-btn.active {
      box-shadow: 0 0 0 2px white, 0 0 0 4px currentColor;
      font-weight: bold;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .modal-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--primary);
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--gray);
    }

    .modal-list {
      list-style-type: none;
    }

    .modal-list li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .modal-list li:last-child {
      border-bottom: none;
    }


    

    /* Responsive Styles */
    @media (max-width: 1200px) {
      .dashboard-panel {
        grid-template-columns: 1fr 1fr;
      }
      
      .panel-section:nth-child(3) {
        grid-column: span 2;
      }
    }

    @media (max-width: 992px) {
      .dashboard-panel {
        grid-template-columns: 1fr;
      }
      
      .panel-section:nth-child(3) {
        grid-column: 1;
      }
      
      .trends-panel {
        grid-template-columns: 1fr;
      }
      
      .pie-chart-container {
        width: 250px;
        height: 250px;
      }
    }

    @media (max-width: 768px) {
      .stats-buttons {
        grid-template-columns: 2fr 2fr;
      }
      
      .trend-filter-buttons {
        flex-wrap: wrap;
      }
      
      .nav-container {
        margin-left: 0;
        justify-content: center;
      }
      
      .pie-chart-container {
        width: 250px;
        height: 250px;
      }
      
      .category-buttons {
        gap: 6px;
      }
      
      .category-btn {
        font-size: 10px;
        padding: 4px 8px;
      }
    }

    @media (max-width: 576px) {
      .dashboard-header h1 {
        font-size: 22px;
      }
      
      .panel-title {
        font-size: 16px;
      }
      
      .pie-chart-container {
        width: 250px;
        height: 250px;
      }
      
      .category-buttons {
        max-height: 100px;
      }
    }

    @media (max-width: 520) {
      .panel-section {
        min-width: 300px;
        max-width: 500px;
      }
    }
    
/* Fixed and scrollable legend container */
.chartjs-legend {
    max-height: 150px;
    overflow-y: auto;
    margin-top: 15px;
}

/* Optional: Custom scrollbar styling */
.chartjs-legend::-webkit-scrollbar {
    width: 6px;
}

.chartjs-legend::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.chartjs-legend::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.chartjs-legend::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
    
  </style>

  <link rel="stylesheet" href="common-styles.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Notification Container -->
  <div class="notification-area" id="notification-area"></div>

  <!-- Modal for displaying lists ->
  <div class="modal" id="list-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Details</h3>
        <button class="close-modal" id="close-modal">&times;</button>
      </div>
      <ul class="modal-list" id="modal-list"></ul>
    </div>
  </div-->


  <header>
    <div class="logo">
      <div class="logo-image">
        <img src="logo.jpg" alt="logo image">
      </div>
      <h2>MES CMS</h2>
    </div>

    <div class="user">
      <h2 id="user-id">Unknown</h2>
      <button class="logout-btn" id="logout-btn">Logout</button>
      <div class="hamburger">
        <i class="fas fa-bars" id="hamburger-btn"></i>
        <div class="navigation-block">
          <div href="dashboard" class="navi-block-items active">Dashboard</div>
          <a href="complaints" class="navi-block-items">Complaints</a>
          <a href="users" class="navi-block-items">Users</a>
          <a href="reporting" class="navi-block-items">Reporting</a>
          <a href="admin" class="navi-block-items"">Admin</a>
        </div>
      </div>
  </header>

  <div class="nav-bar">
    <div class="nav-container">
      <div href="dashboard" class="nav-item active">
        <i class="fas fa-chart-line"></i>
        Dashboard
      </div>
      <a href="complaints" class="nav-item">
        <i class="fas fa-ticket-alt"></i>
        Complaints
      </a>
      <a href="users" class="nav-item">
        <i class="fas fa-users"></i>
        Users
      </a>
      <a href="reporting" class="nav-item">
        <i class="fas fa-file-alt"></i>
        Reporting
      </a>
      <a href="admin" class="nav-item">
        <i class="fas fa-user-tie"></i>
        Admin
      </a>
    </div>
  </div>

  <div class="content">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <i class="fas fa-chart-line"></i>
      <h1>Complaints Statistics</h1>
    </div>

    <!-- Stats Buttons -->
    <div class="stats-buttons">
      <div class="stat-button">
        <div class="stat-icon">
          <img src="all.png" alt="all img">
        </div>
        <div class="stat-title">Total</div>
        <div class="stat-value" id="total-complaints-count">00</div>
      </div>
      
      <div class="stat-button">
        <div class="stat-icon">
          <img src="pause.png" alt="pause img">
        </div>
        <div class="stat-title">Un-Assigned</div>
        <div class="stat-value" id="unassigned-complaints-count">00</div>
      </div>
      
      <div class="stat-button">
        <div class="stat-icon">
          <img src="play.png" alt="play img">
        </div>
        <div class="stat-title">In-Progress</div>
        <div class="stat-value" id="inprogress-complaints-count">00</div>
      </div>
      
      <div class="stat-button">
        <div class="stat-icon">
          <img src="tic.png" alt="tic img">
        </div>
        <div class="stat-title">Completed</div>
        <div class="stat-value" id="completed-complaints-count">00</div>
      </div>
    </div>

    <!-- First Panel -->
    <div class="dashboard-panel">
      <!-- Left: Bar Chart -->
      <div class="panel-section">
        <div class="panel-header">
          <div class="panel-title">Monthly Complaints Status</div>
          <div class="dropdown-menu">
            <button class="dropdown-toggle">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <div class="dropdown-content">
              <a href="#"><i class="fas fa-download"></i> Download SVG</a>
              <a href="#"><i class="fas fa-download"></i> Download PNG</a>
              <a href="#"><i class="fas fa-download"></i> Download CSV</a>
            </div>
          </div>
        </div>
        
        <div class="trend-filter-buttons">
          <button class="filter-btn active pending" data-category="pending">
            <i class="fas fa-exclamation-circle"></i> Pending
          </button>
          <button class="filter-btn active in-progress" data-category="inprogress">
            <i class="fas fa-spinner"></i> InProgress
          </button>
          <button class="filter-btn active completed" data-category="completed">
            <i class="fas fa-check-circle"></i> Completed
          </button>
        </div>
        
        <div class="chart-with-axes">
          <div class="y-axis">
            <!--span>100</span>
            <span>75</span>
            <span>50</span>
            <span>25</span>
            <span>0</span-->
          </div>
          <div class="chart-area">
            <div class="bar-chart" id="monthly-chart"></div>
          </div>
        </div>
      </div>
      
      <!-- Middle: Current Stats -->
      <div class="panel-section">
        <div class="panel-header">
          <div class="panel-title">Current Stats</div>
        </div>
        
        <div class="stats-list">
          <div class="stat-item">
  <div class="stat-item-icon">
    <img src="imgi_4_area.svg" alt="Colonies">
  </div>
  <div class="stat-item-content">
    <div class="stat-item-title">Colonies</div>
    <div class="stat-item-value" id="colony-count">00</div>
  </div>
  <div class="info-tooltip" data-type="colonies">
    <i class="fas fa-question-circle"></i>
    <!--div class="tooltip-content">
      Total Colonies: Click to see the list
    </div-->
  </div>
</div>

<div class="stat-item">
  <div class="stat-item-icon">
    <img src="imgi_5_customer.svg" alt="Customers">
  </div>
  <div class="stat-item-content">
    <div class="stat-item-title">Customers</div>
    <div class="stat-item-value" id="customer-count">00</div>
  </div>
  <div class="info-tooltip" data-type="customers">
    <i class="fas fa-question-circle"></i>
    <!--div class="tooltip-content">
      Total Customers: Click to see the list
    </div-->
  </div>
</div>

<div class="stat-item">
  <div class="stat-item-icon">
    <img src="imgi_6_building.svg" alt="Apartments">
  </div>
  <div class="stat-item-content">
    <div class="stat-item-title">Apartments</div>
    <div class="stat-item-value" id="apartment-count">00</div>
  </div>
  <div class="info-tooltip" data-type="apartments">
    <i class="fas fa-question-circle"></i>
    <!--div class="tooltip-content">
      Total Apartments: Click to see the list
    </div-->
  </div>
</div>

<div class="stat-item">
  <div class="stat-item-icon">
    <img src="imgi_7_staff.svg" alt="Staff/Skillman">
  </div>
  <div class="stat-item-content">
    <div class="stat-item-title">Staff/Skillman</div>
    <div class="stat-item-value" id="skillman-count">00</div>
  </div>
  <div class="info-tooltip" data-type="staff">
    <i class="fas fa-question-circle"></i>
    <!--div class="tooltip-content">
      Total Staff/Skillman: Click to see the list
    </div-->
  </div>
</div>

        </div>
      </div>
      
      <!-- Right: Pie Charts -->
      <div class="panel-section">
        <div class="chart-navigation">
          <button class="nav-btn active" id="category-btn">Categories</button>
          <button class="nav-btn" id="nature-btn">Nature</button>
        </div>
        
        <div class="pie-wrapper">
          <div id="pie-chart-1">
            <div class="panel-header">
              <div class="panel-title">Category Wise Complaints Ratio</div>
            </div>
            <div class="pie-chart-container" id="category-pie-container">
              <canvas class="pie-chart" id="category-pie"></canvas>
            </div>
          </div>
          
          <div id="pie-chart-2" style="display: none;">
            <div class="panel-header">
              <div class="panel-title">Nature Wise Complaints Ratio</div>
            </div>
            <div class="pie-chart-container" id="nature-pie-container">
              <canvas class="pie-chart" id="nature-pie"></canvas>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Trends Panel -->
    <div class="trends-panel" style="display: none;">
      <!-- Filters -->
      <div class="panel-section">
        <div class="panel-header">
          <div class="panel-title">Trends Filters</div>
          <div class="dropdown-menu">
            <button class="dropdown-toggle">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <div class="dropdown-content">
              <a href="#"><i class="fas fa-download"></i> Download SVG</a>
              <a href="#"><i class="fas fa-download"></i> Download PNG</a>
              <a href="#"><i class="fas fa-download"></i> Download CSV</a>
            </div>
          </div>
        </div>
        
        <div class="filters-container">
          <div class="filter-group">
            <label for="trend-type">Trend Type</label>
            <select class="filter-select" id="trend-type">
              <option>Complaints</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="colony">Colony</label>
            <select class="filter-select" id="colony">
              <option value="">All Colonies</option>
              <!-Will be populated dynamically->
            </select>
          </div>
          
          <div class="filter-group">
            <label for="category">Category</label>
            <select class="filter-select" id="category">
                <option value="">All Categories</option>
                <!-Will be populated dynamically->
            </select>
          </div>

          <button class="find-btn" id="find-btn">
            <i class="fas fa-search"></i> Find
          </button>
        </div>
      </div>
      
      <!-- Chart -->
      <div class="panel-section">
        <div class="panel-header">
          <div class="panel-title">Complaints Trends</div>
        </div>
        
        <div class="trend-filter-buttons">
          <button class="filter-btn active completed" data-trend="completed" id="completed">
            <i class="fas fa-check-circle"></i> Complete
          </button>
          <button class="filter-btn active in-progress" data-trend="inprogress" id="in-progress">
            <i class="fas fa-spinner"></i> InProgress
          </button>
          <button class="filter-btn active pending" data-trend="pending" id="pending">
            <i class="fas fa-exclamation-circle"></i> Pending
          </button>
        </div>
        
        <div class="chart-with-axes">
          <div class="y-axis">
            <span>40</span>
            <span>30</span>
            <span>20</span>
            <span>10</span>
            <span>0</span>
          </div>
          <div class="chart-area">
            <div class="bar-chart" id="trends-chart"></div>
          </div>
          <div class="x-axis">
            <span>Jan</span>
            <span>Feb</span>
            <span>Mar</span>
            <span>Apr</span>
            <span>May</span>
            <span>Jun</span>
            <span>Jul</span>
            <span>Aug</span>
            <span>Sep</span>
            <span>Oct</span>
            <span>Nov</span>
            <span>Dec</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="chart-tooltip" id="chart-tooltip"></div>

  
<script>
  const hamburgerBtn = document.getElementById("hamburger-btn");
  const navBlock = document.querySelector(".navigation-block");

  // Toggle navigation on hamburger click
  hamburgerBtn.addEventListener("click", (e) => {
    e.stopPropagation(); // Prevent click from bubbling to document
    navBlock.classList.toggle("active");
  });

  // Close navigation when clicking outside
  document.addEventListener("click", (e) => {
    // Check if click is outside the navigation block and hamburger button
    if (!navBlock.contains(e.target) && e.target !== hamburgerBtn) {
      navBlock.classList.remove("active");
    }
  });

  // Optional: Prevent clicks inside navigation from closing it
  navBlock.addEventListener("click", (e) => {
    e.stopPropagation();
  });
</script>


<script>
  let USER_ID = localStorage.getItem('UserId');
    
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById("user-id").textContent = USER_ID;
      localStorage.removeItem('UserId');
    });

  // Logout functionality
  document.addEventListener('DOMContentLoaded', function() {

    // DOM Elements
    const logoutBtn = document.getElementById('logout-btn');
    
    logoutBtn.addEventListener('click', async () => {
      try {
        const authToken = localStorage.getItem('authToken');
        const response = await fetch(SERVER_URL+'/logout', {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${authToken}`,'Content-Type': 'application/json' }
        });

        const data = await response.json();

        if (response.ok) {
          document.getElementById("user-id").textContent = 'Unknown';
          console.log('Logout success:', data);
          alert('Logged out successfully!');
          
          // ðŸ‘‡ you can add more procedural lines here
          // e.g., redirect:
          setTimeout(() => {
            window.location.href = 'login.html';
          }, 500); // 500 ms = 0.5 sec

        } else {
          console.error('Logout failed:', data);
          alert('Logout failed!');
        }

      } catch (error) {
        console.error('Error:', error);
        alert('Something went wrong!');
      }
    });
    
  });
</script>

<script>
// Add this script to control navigation visibility based on backend permissions
document.addEventListener('DOMContentLoaded', async function() {
    try {
        const authToken = localStorage.getItem('authToken');
        if (!authToken) {
            console.error('No authentication token found');
            return;
        }

        // Fetch allowed pages from backend
        const response = await fetch(`${SERVER_URL}/api/allowed-pages`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error('Failed to fetch allowed pages');
        }

        const data = await response.json();
        
        if (data.success) {
            // Process navigation items based on allowed pages
            processNavigationItems(data.allowedPages, data.navigationItems);
        }
    } catch (error) {
        console.error('Error fetching allowed pages:', error);
        // In case of error, you might want to show a default set of navigation items
        // or handle it according to your application's requirements
    }
});

function processNavigationItems(allowedPages, navigationItems) {
    // Process header navigation items
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => {
        const href = item.getAttribute('href');
        if (href) {
            const pageName = href; // Get the page name without extension
            
            // Check if this category has an accessible page
            if (navigationItems[pageName]) {
                // Set the href to the first accessible page in this category
                item.setAttribute('href', `${navigationItems[pageName]}.html`);
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        }
    });
    
    // Process hamburger menu navigation items
    const hamburgerItems = document.querySelectorAll('.navi-block-items');
    hamburgerItems.forEach(item => {
        const href = item.getAttribute('href');
        if (href) {
            const pageName = href; // Get the page name without extension
            
            // Check if this category has an accessible page
            if (navigationItems[pageName]) {
                // Set the href to the first accessible page in this category
                item.setAttribute('href', `${navigationItems[pageName]}.html`);
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        }
    });
    
    // Process sidebar navigation items (use the allowedPages array)
    const sidebarItems = document.querySelectorAll('.complaints-option');
    sidebarItems.forEach(item => {
        const href = item.getAttribute('href');
        if (href) {
            const pageName = getPageNameFromHref(href);
            if (allowedPages.includes(pageName) || item.classList.contains('active')) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        }
    });
}

function getPageNameFromHref(href) {
    if (!href) return '';
    
    // Extract page name from href (e.g., "dashboard.html" -> "dashboard")
    const pageWithExtension = href.split('/').pop();
    return pageWithExtension.split('.')[0];
}
</script>


  <script>
    
    // Dummy data for charts
let monthlyData = {
  months: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
  pending: [],
  inprogress: [],
  completed: []
};
/*
const COLOR_PALETTE = [
  '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', 
  '#FF9F40', '#FF6384', '#C9CBCF', '#7CFC00', '#20B2AA',
  '#FF00FF', '#FFD700', '#00FF7F', '#1E90FF', '#FF4500',
  '#9370DB', '#32CD32', '#8A2BE2', '#FF1493', '#00BFFF',
  '#228B22', '#DA70D6', '#CD5C5C', '#F0E68C', '#E6E6FA',
  '#7B68EE', '#FFA07A', '#3CB371', '#B22222', '#DAA520'
];*/
const COLOR_PALETTE = [
  '#FF1E56', // vivid pink-red
  '#00C9FF', // electric cyan
  '#FFB800', // bright amber
  '#00E676', // neon green
  '#7C4DFF', // vivid violet
  '#FF6D00', // blazing orange
  '#D500F9', // neon purple
  '#00BFA5', // aqua teal
  '#FF1744', // intense red
  '#2979FF', // bold blue
  '#FF4081', // hot pink
  '#FFD600', // neon yellow
  '#76FF03', // bright lime
  '#1DE9B6', // bright turquoise
  '#FF3D00', // flame red-orange
  '#651FFF', // electric indigo
  '#64DD17', // neon green-yellow
  '#AA00FF', // magenta
  '#F50057', // vivid raspberry
  '#00B0FF', // sky neon blue
  '#00E5FF', // bright cyan
  '#FFAB00', // golden orange
  '#C51162', // rich magenta-pink
  '#AEEA00', // chartreuse
  '#D50000', // deep vivid red
  '#304FFE', // intense cobalt blue
  '#00C853', // emerald neon green
  '#FF9100', // orange neon
  '#6200EA'  // deep vivid violet
];


    const categoryData = [
      { name: 'E & M I', value: 20, color: '#FF6384' },
      { name: 'E & M II', value: 15, color: '#36A2EB' },
      { name: 'B & R I', value: 25, color: '#FFCE56' },
      { name: 'B & R II', value: 18, color: '#4BC0C0' },
      { name: 'B & R III', value: 22, color: '#9966FF' }
    ];

    const natureData = [
      { name: 'Plumbing', value: 4, color: '#FF6384' },
      { name: 'Electrical External Svcs', value: 3, color: '#36A2EB' },
      { name: 'Wood Work', value: 4, color: '#FFCE56' },
      { name: 'Mason Work', value: 3, color: '#4BC0C0' },
      { name: 'Distemper/Paint Work', value: 3, color: '#9966FF' },
      { name: 'Welding Work', value: 2, color: '#FF9F40' },
      { name: 'Curtain Work', value: 2, color: '#FF6384' },
      { name: 'Aluminium', value: 2, color: '#36A2EB' },
      { name: 'Seepage/Leakage', value: 3, color: '#FFCE56' },
      { name: 'Glazier', value: 2, color: '#4BC0C0' },
      { name: 'Sanitary Worker', value: 3, color: '#9966FF' },
      { name: 'Electrical', value: 4, color: '#FF9F40' },
      { name: 'Water Supply', value: 3, color: '#FF6384' },
      { name: 'Sui Gas', value: 2, color: '#36A2EB' },
      { name: 'Geyser', value: 3, color: '#FFCE56' },
      { name: 'Cooking Range/Hub Stove', value: 2, color: '#4BC0C0' },
      { name: 'Gas External Svcs', value: 2, color: '#9966FF' },
      { name: 'P/F External Svcs', value: 2, color: '#FF9F40' },
      { name: 'Pressure Motor', value: 2, color: '#FF6384' },
      { name: 'Gas/Water Pressure', value: 2, color: '#36A2EB' },
      { name: 'Lift Operating', value: 2, color: '#FFCE56' },
      { name: 'Performa Work', value: 2, color: '#4BC0C0' },
      { name: 'Labour External Svcs', value: 3, color: '#9966FF' },
      { name: 'AC (Air Conditioner)', value: 3, color: '#FF9F40' },
      { name: 'POLISHIR', value: 2, color: '#FF6384' },
      { name: 'Wood Work F&S', value: 3, color: '#36A2EB' }
    ];

    const trendsData = {
      categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
      pending: [20, 25, 30, 22, 28, 32, 35, 38, 40, 42, 45, 48],
      inprogress: [15, 18, 22, 19, 24, 26, 28, 30, 32, 34, 36, 38],
      completed: [25, 30, 28, 32, 35, 38, 40, 42, 45, 48, 50, 52]
    };

    // Data for tooltips
    const coloniesList = [
      "Ch Afzal", "Majid Shaheed", "Tanveer Naqvi", "Israr Ghuman", 
      "Rana Ayaz Ahmed", "Hamid Javeed", "Rana Ayaz", "Non-Resdl", 
      "Khan pur Scheme", "Shabbir Shah", "Choudary Afzaal"
    ];
    
    const customersList = [
      "Customer 1", "Customer 2", "Customer 3", "Customer 4", 
      "Customer 5", "Customer 6", "Customer 7", "Customer 8"
    ];
    
    const apartmentsList = [
      "Apartment 1", "Apartment 2", "Apartment 3", "Apartment 4", 
      "Apartment 5", "Apartment 6", "Apartment 7", "Apartment 8"
    ];
    
    const staffList = [
      "Staff 1", "Staff 2", "Staff 3", "Staff 4", 
      "Staff 5", "Staff 6", "Staff 7", "Staff 8"
    ];

    function adjustBrightness(hex, percent) {
  // Strip the # if it's there
  hex = hex.replace(/^\s*#|\s*$/g, '');

  // Convert 3 char codes to 6
  if (hex.length === 3) {
    hex = hex.replace(/(.)/g, '$1$1');
  }

  let r = parseInt(hex.substr(0, 2), 16);
  let g = parseInt(hex.substr(2, 2), 16);
  let b = parseInt(hex.substr(4, 2), 16);

  // Adjust brightness
  r = Math.max(0, Math.min(255, r + (r * (percent / 100))));
  g = Math.max(0, Math.min(255, g + (g * (percent / 100))));
  b = Math.max(0, Math.min(255, b + (b * (percent / 100))));

  // Convert back to hex
  let newHex = ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
  return '#' + newHex;
}

    // Initialize charts
// Initialize charts
document.addEventListener('DOMContentLoaded', async function() {
  // Set user ID
  
  // Fetch data from backend
  const monthlyBackendData = await fetchMonthlyData();
  const categoryBackendData = await fetchCategoryData();
  const natureBackendData = await fetchNatureData();
  
  // Update monthlyData with backend data
  if (monthlyBackendData) {
    monthlyData.pending = monthlyBackendData.pending || [];
    monthlyData.inprogress = monthlyBackendData.inprogress || [];
    monthlyData.completed = monthlyBackendData.completed || [];
  }
  
  // Render charts with fetched data or show error
  renderMonthlyChart();
  
  if (categoryBackendData && categoryBackendData.length > 0) {
    renderCategoryPieChart(categoryBackendData);
  } else {
    showNoDataMessage('category-pie-container', 'No category data found');
  }
  
  if (natureBackendData && natureBackendData.length > 0) {
    renderNaturePieChart(natureBackendData);
  } else {
    showNoDataMessage('nature-pie-container', 'No nature data found');
  }
  
  renderTrendsChart();
  
  // Setup event listeners
  setupEventListeners();
});


// Function to fetch monthly complaints data from backend
async function fetchMonthlyData() {
  try {
    const authToken = localStorage.getItem('authToken');
    const response = await fetch(SERVER_URL+'/api/monthly-complaints', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${authToken}`,
        'Content-Type': 'application/json',
      }
    });
    
    if (!response.ok) {
      throw new Error(`Server returned ${response.status}: ${response.statusText}`);
    }
    
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error fetching monthly data:', error);
    showNotification('Failed to load monthly complaints data', 'error');
    return null;
  }
}


    // Render monthly bar chart
// Render monthly bar chart
function renderMonthlyChart() {
  const chartContainer = document.getElementById('monthly-chart');
  chartContainer.innerHTML = '';
  
  // Check if we have data to display
  const hasData = monthlyData.pending.some(val => val > 0) || 
                 monthlyData.inprogress.some(val => val > 0) || 
                 monthlyData.completed.some(val => val > 0);
  
  const maxValue = hasData ? Math.max(
    ...monthlyData.pending, 
    ...monthlyData.inprogress, 
    ...monthlyData.completed
  ) : 100; // Default max value if no data
  
  const chartHeight = 200;
  
  monthlyData.months.forEach((month, i) => {
    const barContainer = document.createElement('div');
    barContainer.className = 'bar-container';
    
    const barGroup = document.createElement('div');
    barGroup.className = 'bar-group';
    
    // Create bars for each category
    if (isCategoryActive('pending')) {
      const pendingBar = createBar(
        monthlyData.pending[i] || 0, 
        maxValue, 
        chartHeight, 
        '#e74c3c',  
        `Pending: ${monthlyData.pending[i] || 0}`
      );
      barGroup.appendChild(pendingBar);
    }
    
    if (isCategoryActive('inprogress')) {
      const inprogressBar = createBar(
        monthlyData.inprogress[i] || 0, 
        maxValue, 
        chartHeight, 
        '#f39c12',
        `InProgress: ${monthlyData.inprogress[i] || 0}`
      );
      barGroup.appendChild(inprogressBar);
    }
    
    if (isCategoryActive('completed')) {
      const completedBar = createBar(
        monthlyData.completed[i] || 0, 
        maxValue, 
        chartHeight, 
        '#2ecc71', 
        `Completed: ${monthlyData.completed[i] || 0}`
      );
      barGroup.appendChild(completedBar);
    }
    
    barContainer.appendChild(barGroup);
    
    const label = document.createElement('div');
    label.className = 'bar-label';
    label.textContent = month;
    barContainer.appendChild(label);
    
    chartContainer.appendChild(barContainer);
  });
  
  // Show message if no data
  if (!hasData) {
    const noDataMessage = document.createElement('div');
    noDataMessage.style.textAlign = 'center';
    noDataMessage.style.marginTop = '20px';
    noDataMessage.style.color = '#999';
    noDataMessage.innerHTML = 'No complaints data available';
    chartContainer.appendChild(noDataMessage);
  }
}



// Add these functions to fetch data from the backend:
async function fetchCategoryData() {
  try {
    const authToken = localStorage.getItem('authToken');
    const response = await fetch(SERVER_URL+'/api/category-complaints', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${authToken}`,
        'Content-Type': 'application/json',
      }
    });
    
    if (!response.ok) {
      throw new Error(`Server returned ${response.status}: ${response.statusText}`);
    }
    
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error fetching category data:', error);
    showNotification('Failed to load category complaints data', 'error');
    return null;
  }
}

async function fetchNatureData() {
  try {
    const authToken = localStorage.getItem('authToken');
    const response = await fetch(SERVER_URL+'/api/nature-complaints', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${authToken}`,
        'Content-Type': 'application/json',
      }
    });
    
    if (!response.ok) {
      throw new Error(`Server returned ${response.status}: ${response.statusText}`);
    }
    
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error fetching nature data:', error);
    showNotification('Failed to load nature complaints data', 'error');
    return null;
  }
}

    // Create a bar element
    function createBar(value, maxValue, chartHeight, color, tooltipText) {
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.style.height = `${(value / maxValue) * chartHeight}px`;
      bar.style.backgroundColor = color;
      
      // Add tooltip
      bar.addEventListener('mousemove', (e) => {
        const tooltip = document.getElementById('chart-tooltip');
        tooltip.innerHTML = tooltipText;
        tooltip.style.opacity = '1';
        tooltip.style.left = `${e.pageX + 10}px`;
        tooltip.style.top = `${e.pageY - 30}px`;
      });
      
      bar.addEventListener('mouseout', () => {
        document.getElementById('chart-tooltip').style.opacity = '0';
      });
      
      return bar;
    }

    // Check if a category is active
    function isCategoryActive(category) {
      const filterBtn = document.querySelector(`.filter-btn[data-category="${category}"]`);
      return filterBtn && filterBtn.classList.contains('active');
    }

    // Render category pie chart
// Update the renderCategoryPieChart function to accept data parameter:
function renderCategoryPieChart(categoryData) {
  const ctx = document.getElementById('category-pie').getContext('2d');
  
  // Check if a chart instance already exists and destroy it
  if (window.categoryChartInstance) {
    window.categoryChartInstance.destroy();
  }
  
  // Assign colors from the palette
  const coloredData = categoryData.map((item, index) => ({
    ...item,
    color: COLOR_PALETTE[index % COLOR_PALETTE.length]
  }));
  
  window.categoryChartInstance = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: coloredData.map(item => item.name),
      datasets: [{
        data: coloredData.map(item => item.value),
        backgroundColor: coloredData.map(item => item.color),
        borderColor: '#ffffff',
        borderWidth: 2,
        hoverBackgroundColor: coloredData.map(item => 
          adjustBrightness(item.color, -20) // Darken on hover
        ),
        hoverBorderColor: '#ffffff',
        hoverBorderWidth: 3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            usePointStyle: true,    // Add this line
            pointStyle: 'circle',   // Add this line
            font: {
              size: 11
            },
            padding: 15
          }
        },
        datalabels: {
          color: '#fff',
          font: {
            weight: 'bold',
            size: 12
          },
          textStrokeColor: '#000',
          textStrokeWidth: 2,
          anchor: 'end',
          align: 'end',
          offset: -45,
          formatter: (value, context) => {
            const dataset = context.chart.data.datasets[0].data;
            const total = dataset.reduce((a, b) => a + b, 0);
            const percentage = ((value / total) * 100).toFixed(1) + "%";
            return percentage;
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.raw || 0;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((value / total) * 100).toFixed(1);
              return `${label}: ${value} (${percentage}%)`;
            }
          }
        }
      }
    },
    plugins: [ChartDataLabels]
  });
}

// Update the renderNaturePieChart function
function renderNaturePieChart(natureData) {
  const ctx = document.getElementById('nature-pie').getContext('2d');
  
  // Check if a chart instance already exists and destroy it
  if (window.natureChartInstance) {
    window.natureChartInstance.destroy();
  }
  
  // Assign colors from the palette (starting from a different position for variety)
  const coloredData = natureData.map((item, index) => ({
    ...item,
    color: COLOR_PALETTE[(index + 5) % COLOR_PALETTE.length] // Start from position 5 for variety
  }));
  
  window.natureChartInstance = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: coloredData.map(item => item.name),
      datasets: [{
        data: coloredData.map(item => item.value),
        backgroundColor: coloredData.map(item => item.color),
        borderColor: '#ffffff',
        borderWidth: 2,
        hoverBackgroundColor: coloredData.map(item => 
          adjustBrightness(item.color, -20) // Darken on hover
        ),
        hoverBorderColor: '#ffffff',
        hoverBorderWidth: 3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            usePointStyle: true,    // Add this line
            pointStyle: 'circle',   // Add this line
            font: {
              size: 11
            },
            padding: 15
          }
        },
        datalabels: {
          color: '#fff',
          font: {
            weight: 'bold',
            size: 12
          },
          textStrokeColor: '#000',
          textStrokeWidth: 2,
          anchor: 'end',
          align: 'end',
          offset: -35,
          formatter: (value, context) => {
            const dataset = context.chart.data.datasets[0].data;
            const total = dataset.reduce((a, b) => a + b, 0);
            const percentage = ((value / total) * 100).toFixed(1) + "%";
            return percentage;
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.raw || 0;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((value / total) * 100).toFixed(1);
              return `${label}: ${value} (${percentage}%)`;
            }
          }
        }
      }
    },
    plugins: [ChartDataLabels]
  });
}

// Add this function to show error messages:
function showNoDataMessage(containerId, message) {
  const container = document.getElementById(containerId);
  container.innerHTML = `<div style="text-align: center; padding: 20px; color: #999;">${message}</div>`;
}

    // Highlight a segment in the pie chart
    function highlightSegment(segment, color) {
      // Remove highlight from all segments
      document.querySelectorAll('.pie-segment').forEach(seg => {
        seg.classList.remove('highlighted');
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Highlight the selected segment
      segment.classList.add('highlighted');
      
      // Find and activate the corresponding button
      const segmentName = segment.dataset.name;
      const buttons = document.querySelectorAll('.category-btn');
      buttons.forEach(btn => {
        if (btn.textContent.includes(segmentName)) {
          btn.classList.add('active');
        }
      });
      
      // Show notification with segment info
      showNotification(`${segmentName}: ${segment.dataset.value} (${segment.dataset.percentage}%)`, 'info');
    }

    // Render trends chart
    function renderTrendsChart() {
      const chartContainer = document.getElementById('trends-chart');
      chartContainer.innerHTML = '';
      
      const maxValue = Math.max(
        ...trendsData.pending, 
        ...trendsData.inprogress, 
        ...trendsData.completed
      );
      
      const chartHeight = 200;
      
      trendsData.categories.forEach((category, i) => {
        const barContainer = document.createElement('div');
        barContainer.className = 'bar-container';
        
        const barGroup = document.createElement('div');
        barGroup.className = 'bar-group';
        
        // Create bars for each trend
        if (isTrendActive('pending')) {
          const pendingBar = createBar(
            trendsData.pending[i], 
            maxValue, 
            chartHeight, 
            '#e74c3c', 
            `Pending: ${trendsData.pending[i]}`
          );
          barGroup.appendChild(pendingBar);
        }
        
        if (isTrendActive('inprogress')) {
          const inprogressBar = createBar(
            trendsData.inprogress[i], 
            maxValue, 
            chartHeight, 
            '#f39c12', 
            `InProgress: ${trendsData.inprogress[i]}`
          );
          barGroup.appendChild(inprogressBar);
        }
        
        if (isTrendActive('completed')) {
          const completedBar = createBar(
            trendsData.completed[i], 
            maxValue, 
            chartHeight, 
            '#2ecc71', 
            `Completed: ${trendsData.completed[i]}`
          );
          barGroup.appendChild(completedBar);
        }
        
        barContainer.appendChild(barGroup);
        
        const label = document.createElement('div');
        label.className = 'bar-label';
        label.textContent = category;
        barContainer.appendChild(label);
        
        chartContainer.appendChild(barContainer);
      });
    }

    // Check if a trend is active
    function isTrendActive(trend) {
      const trendBtn = document.querySelector(`.filter-btn[data-trend="${trend}"]`);
      return trendBtn && trendBtn.classList.contains('active');
    }

    // Setup event listeners
    function setupEventListeners() {
      // Monthly chart filter buttons
      document.querySelectorAll('.filter-btn[data-category]').forEach(btn => {
        btn.addEventListener('click', () => {
          btn.classList.toggle('active');
          renderMonthlyChart();
        });
      });
      
      // Trends chart filter buttons
      document.querySelectorAll('.filter-btn[data-trend]').forEach(btn => {
        btn.addEventListener('click', () => {
          btn.classList.toggle('active');
          renderTrendsChart();
        });
      });
      
      // Pie chart navigation
      document.getElementById('category-btn').addEventListener('click', function() {
        this.classList.add('active');
        document.getElementById('nature-btn').classList.remove('active');
        navigateToPieChart(1);
      });
      
      document.getElementById('nature-btn').addEventListener('click', function() {
        this.classList.add('active');
        document.getElementById('category-btn').classList.remove('active');
        navigateToPieChart(2);
      });
      
      // Find button
      document.getElementById('find-btn').addEventListener('click', function() {
        const colony = document.getElementById('colony').value;
        const category = document.getElementById('category').value;
        
        // Simulate filtering data
        showNotification(`Showing trends for ${colony} - ${category}`, 'info');
        
        // Update trends data based on selection (simulated)
        trendsData.pending = trendsData.pending.map(() => Math.floor(Math.random() * 20) + 10);
        trendsData.inprogress = trendsData.inprogress.map(() => Math.floor(Math.random() * 20) + 15);
        trendsData.completed = trendsData.completed.map(() => Math.floor(Math.random() * 20) + 20);
        
        renderTrendsChart();
      });

      // Info tooltip click handlers
      document.querySelectorAll('.info-tooltip').forEach(tooltip => {
        tooltip.addEventListener('click', function() {
          const type = this.getAttribute('data-type');
          showModal(type);
        });
      });

      // Modal close button
      document.getElementById('close-modal').addEventListener('click', function() {
        document.getElementById('list-modal').style.display = 'none';
      });

      // Close modal when clicking outside
      window.addEventListener('click', function(event) {
        const modal = document.getElementById('list-modal');
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
    }

    // Navigate to specific pie chart
    function navigateToPieChart(chartNumber) {
      document.getElementById('pie-chart-1').style.display = chartNumber === 1 ? 'block' : 'none';
      document.getElementById('pie-chart-2').style.display = chartNumber === 2 ? 'block' : 'none';
    }

    // Show modal with list
    function showModal(type) {
      const modal = document.getElementById('list-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalList = document.getElementById('modal-list');
      
      // Clear previous list
      modalList.innerHTML = '';
      
      // Set title and list based on type
      let title = '';
      let listItems = [];
      
      switch(type) {
        case 'colonies':
          title = 'Colonies List';
          listItems = coloniesList;
          break;
        case 'customers':
          title = 'Customers List';
          listItems = customersList;
          break;
        case 'apartments':
          title = 'Apartments List';
          listItems = apartmentsList;
          break;
        case 'staff':
          title = 'Staff/Skillman List';
          listItems = staffList;
          break;
      }
      
      modalTitle.textContent = title;
      
      // Add items to the list
      listItems.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        modalList.appendChild(li);
      });
      
      // Show the modal
      modal.style.display = 'flex';
    }

    // Show notification
    function showNotification(message, type = 'info') {
      const notificationArea = document.getElementById('notification-area');
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <i class="fas fa-${type === 'info' ? 'info-circle' : 'check-circle'}"></i>
        ${message}
      `;
      
      notificationArea.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
  </script>
  <script>
    // Function to fetch data from the backend server
async function fetchStatsData() {
    try {
      const authToken = localStorage.getItem('authToken');
        const response = await fetch(SERVER_URL+'/api/stats', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        });
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching stats data:', error);
        // You might want to implement retry logic or show an error message to the user
        return null;
    }
}

// Function to update the DOM with new values
function updateStatsDisplay(data) {
    if (data && typeof data === 'object') {
        // Update each stat value if it exists in the data
        if (data.colonies !== undefined) {
            document.getElementById('colony-count').textContent = data.colonies;
        }
        if (data.customers !== undefined) {
            document.getElementById('customer-count').textContent = data.customers;
        }
        if (data.apartments !== undefined) {
            document.getElementById('apartment-count').textContent = data.apartments;
        }
        if (data.skillman !== undefined) {
            document.getElementById('skillman-count').textContent = data.skillman;
        }
    }
}

// Function to initialize and periodically update stats
function initializeStats() {
    // Initial fetch
    fetchStatsData().then(updateStatsDisplay);
    
    // Set up periodic updates (every 30 seconds)
    setInterval(async () => {
        const data = await fetchStatsData();
        updateStatsDisplay(data);
    }, 30000);
}

// Start the process when the DOM is fully loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeStats);
} else {
    initializeStats();
}
  </script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const colonySelect = document.getElementById("colony");
    const authToken = localStorage.getItem('authToken');

    // Fetch colonies from backend endpoint
    fetch(SERVER_URL+"/api/get-categories-for-dashboard", {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        })
      .then(response => {
        if (!response.ok) {
          throw new Error("Failed to fetch colonies");
        }
        return response.json();
      })
      .then(data => {
        // Example: [ { ColonyNumber: "C001", Name: "Alpha Colony" }, ... ]
        data.forEach(colony => {
          const option = document.createElement("option");
          option.value = colony.ColonyNumber;
          option.textContent = colony.Name;
          colonySelect.appendChild(option);
        });
      })
      .catch(error => {
        console.error("Error loading colonies:", error);
      });
  });
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const categorySelect = document.getElementById("category");

  // Clear any existing options except the first one (if it exists)
  while (categorySelect.options.length > 1) {
    categorySelect.remove(1);
  }
  const authToken = localStorage.getItem('authToken');
  fetch(SERVER_URL+"/api/get-categories-for-dashboard", {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        })
    .then(res => {
      if (!res.ok) {
        throw new Error(`HTTP error! Status: ${res.status}`);
      }
      return res.json();
    })
    .then(data => {
      if (data && data.length > 0) {
        data.forEach(item => {
          const option = document.createElement("option");
          option.value = item.name;       // Use the name property
          option.textContent = item.name; // Show the name
          categorySelect.appendChild(option);
        });
      } else {
        console.warn("No categories returned from API");
        // Add a disabled option to indicate no categories
        const option = document.createElement("option");
        option.value = "";
        option.textContent = "No categories available";
        option.disabled = true;
        categorySelect.appendChild(option);
      }
    })
    .catch(err => {
      console.error("Error loading categories:", err);
      // Show error to user
      const option = document.createElement("option");
      option.value = "";
      option.textContent = "Failed to load categories";
      option.disabled = true;
      categorySelect.appendChild(option);
    });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('category');
    const authToken = localStorage.getItem('authToken');
    fetch(SERVER_URL+'/get-categories-for-dashboard', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Clear existing options except the first one
            while (categorySelect.options.length > 1) {
                categorySelect.remove(1);
            }
            
            if (data && data.length > 0) {
                data.forEach(category => {
                    const option = document.createElement('option');
                    // Decode the values received from the server
                    option.value = decodeURIComponent(category.id || category.value);
                    option.textContent = decodeURIComponent(category.name || category.label);
                    categorySelect.appendChild(option);
                });
            } else {
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "No data found";
                categorySelect.appendChild(option);
            }
        })
        .catch(error => {
            console.error('Error fetching categories:', error);
            const option = document.createElement('option');
            option.value = "";
            option.textContent = "No data found";
            categorySelect.appendChild(option);
        });
});


</script>

<script>
async function fetchComplaintStats() {
  try {
    
    const authToken = localStorage.getItem('authToken');
    // Call backend API (adjust endpoint name if different)
    const response = await fetch(SERVER_URL+'/api/complaints-summary-count', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            }
        });
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }

    const data = await response.json();

    // Expected structure from backend:
    // {
    //   total: 120,
    //   unassigned: 30,
    //   inprogress: 50,
    //   completed: 40
    // }

    // Update DOM values
    document.getElementById('total-complaints-count').textContent = data.total ?? '00';
    document.getElementById('unassigned-complaints-count').textContent = data.unassigned ?? '00';
    document.getElementById('inprogress-complaints-count').textContent = data.inprogress ?? '00';
    document.getElementById('completed-complaints-count').textContent = data.completed ?? '00';

  } catch (error) {
    console.error('Error fetching complaint stats:', error);
  }
}

// Fetch immediately on load
document.addEventListener('DOMContentLoaded', fetchComplaintStats);

// Optionally refresh every 30 seconds
setInterval(fetchComplaintStats, 30000);






// Map each button's title to the corresponding query status
const statusMap = {
  'Total': 'all',
  'Un-Assigned': 'Un-Assigned',
  'In-Progress': 'In-Progress',
  'Completed': 'Completed'
};

// Select all stat buttons
const statButtons = document.querySelectorAll('.stat-button');

statButtons.forEach(button => {
  button.addEventListener('click', () => {
    const title = button.querySelector('.stat-title').textContent.trim();
    const status = statusMap[title];

    if (status) {
      window.location.href = `status-wise-complaints.html?status=${status}`;
    } else {
      console.warn('No status mapping found for', title);
    }
  });
});

// Add this to your existing JavaScript
function adjustPieChartSize() {
  const isNatureChart = document.getElementById('pie-chart-2').style.display === 'block';
  const container = document.getElementById(isNatureChart ? 'nature-pie-container' : 'category-pie-container');
  
  if (window.innerWidth <= 992 && window.innerWidth > 576) {
    // Tablet view
    if (isNatureChart) {
      container.style.width = '500px';
      container.style.height = '500px';
    }
  }
  if (window.innerWidth > 992) {
    // Tablet view
    if (isNatureChart) {
      container.style.width = '400px';
      container.style.height = '500px';
    }
  }
  
  // Refresh the chart if it exists
  if (isNatureChart && window.natureChartInstance) {
    window.natureChartInstance.resize();
  } else if (window.categoryChartInstance) {
    window.categoryChartInstance.resize();
  }
}

// Call this when switching charts
document.getElementById('nature-btn').addEventListener('click', function() {
  setTimeout(adjustPieChartSize, 100);
});

document.getElementById('category-btn').addEventListener('click', function() {
  setTimeout(adjustPieChartSize, 100);
});

// Also adjust on window resize
window.addEventListener('resize', adjustPieChartSize);
</script>

  <script src="chat-bot.js"></script>


</body>
</html>